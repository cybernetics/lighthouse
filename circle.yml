machine:
  node:
    version: 4.4
dependencies:
   cache_directories:
     - node_modules
     - chrome-linux
     - lighthouse-extension/node_modules
dependencies:
  pre:
    - npm --prefix ./lighthouse-extension install ./lighthouse-extension
    - export DISPLAY=:99.0
    - export LIGHTHOUSE_CHROMIUM_PATH="$(pwd)/chrome-linux/chrome"
    - sh -e /etc/init.d/xvfb start
    - ./lighthouse-core/scripts/download-chrome.sh
test:
  override:
    - if [[ $(node -v) =~ ^v4.* ]]; then export __node_harmony=--harmony; fi
    - npm run lint
    - npm run unit
    - npm run closure
    - npm run coveralls
    - npm run smoke
    - cd lighthouse-extension && gulp build
